
Сборка:

- **sha1** d12097af4ac52c5a296d4cff9f56f62c902cff79 - [scorocode-cli_1.0.1_amd64.deb](https://github.com/PROFITVenchurs/scorocode-cli-bin/blob/master/scorocode-cli_1.0.1_amd64.deb)
- **sha1** 0ea57daa24ce0cc565a80f0fb2d6d76efe7007c0 - [scorocode-cli-1.0.1.pkg](https://github.com/PROFITVenchurs/scorocode-cli-bin/blob/master/scorocode-cli-1.0.1.pkg)
- **sha1** 824214d24f4f5fb3684082653b21c4bfff295d65 - [scorocode-cli_1.0.1_x86.msi](https://github.com/PROFITVenchurs/scorocode-cli-bin/blob/master/scorocode-cli_1.0.1_x86.msi)


## Инструкция по использованию *scorocode-cli*

scorocode-cli - консольная утилита для работы с приложениями на https://scorocode.ru

### Краткое описание работы

С помощью scorocode-cli скачиваем приложение с https://scorocode.ru, и далее путем выполнения
необходимых команд переносим изменения из локальной копии приложения на https://scorocode.ru.

Справку о доступных командах и их параметрах можно получить путем выполнения команд:
- scorocode-cli -help
- scorocode-cli <команда> -help

### Получение приложения с https://scorocode.ru

```bash
scorocode-cli fetch -app <ключ приложения> \
                    -cli <клиентский ключ, всегда -'javascript'> \
                    -acc <ключ приложения, всегда - 'masterKey'> \
                    [-dir путь к новому каталогу, в который будет клонировано приложение. Если не задан, то в текущей директории будет создан каталог, с именем соответствующим имени приложения]
```

После выполнения данной команды, в каталог будет клонирована информация:
- параметры проекта - *scorocode.json*
- описание приложения - *application.json*
- описание коллекций - *collections*
- серверные скрипты - *scripts*
- шаблоны писем - *mail_templates*


#### scorocode.json

_**ВНИМАНИЕ!**_ **Не рекомендуется выкладывать этот файл в общий доступ, а также хранить в системе контроля версий. Т.к. в нем хранится информация о секретных ключах приложения!**

Данный файл необходим для хранения параметров подключения к приложения на https://scorocode.ru

```javascript
{
    "branches": [
        {
            // Наименование ветки Git. По умолчанию "master"
            // Если git не используется, то использовать "master"
            "name": "master",

            // Путь к статическим файлам приложения. Пример:
            // 1. путь к архиву zip, который будет распакован на сервере (пример: /mydir/static.zip)
            // 2. путь к файлу (пример: /index.html)
            // 3. путь к каталогу (пример: /mydir).
            //
            // Путь к файлу может быть как относительным (по отношению к каталогу в котором находится файл scorocode.json), так и полным
            "static": "index.html",

            // Ключи приложения:
            "keys": {
                "appId": "<ключ приложения>",
                "master": "ключ приложения, всегда - 'masterKey'",
                "client": "клиентский ключ, всегда -'javascript'"
            }
        }
    ]
}
```


### Команды изменения структуры и метаданных приложения

#### Загрузка статического контента

Статический контент - это набор файлов (html, картинки и т.д.), которые будут находится в публичном доступе по адресу: https://<доменное имя>.scorocode.io

Перед загрузкой статического контента необходимо:
- установить доменное имя в настройках приложения
- в файле [scorocode.json](#scorocodejson) установить путь к файлу со статическим контентом в локальной файловой системе. Параметр *"static"*

```bash
scorocode-cli static [-dir <путь к каталогу, в котором находится файл scorocode.json. По умолчанию - это текущий каталог>]
```


### Скрипты

Все скрипты находятся в каталоге проекта /scripts. Каждый скрипт представлен двумя файлами:
- ***<имя скрипта>**.js* - код скрипта
- ***<имя скрипта>**.json* - метаданные скрипта

```javascript
{
    // идентификат скрипта на https://scorocode.ru (**не изменять**)
    "_id": "585be98222a5483cbcfe2ad6",

    // Краткое описание скрипта
    "description": "",

    // Признак автоматического запуска скрипта на сервере по расписанию или единожды
    "isActiveJob": false,

    // Наименование используемого таймера для запуска по расписанию.
    // Возможные варианты:
    // "once" - единожды
    // "custom" - произвольно
    // "daily" - ежедневно
    // "monthly" - ежемесячно
    "jobType": "daily",

    // Список контроля доступа (идентификаторы ролей или идентификаторы пользователей)
    "ACL": [],

    // Время первого запуска скрипта по расписанию в формате RFC3339
    "jobStartAt": "2017-07-03T15:30:19.751+03:00",

    // Параметры расписания:
    "repeat": {

        // Параметры запуска для произвольного периода выполнения. Где:
        // days - количество дней, через которые выполнять скрипт
        // hours - количество часов, через которые выполнять скрипт
        // minutes - количество минут, через которые выполнять скрипт
        "custom": {
            "days": 0,
            "hours": 0,
            "minutes": 0
        },

        // Параметры запуска для ежедневного периода выполнения. Где:
        // on - массив номеров дней от 1 до 7, в которые должен выполняться скрипт
        // hours - час, в который должен быть выполнен скрипт
        // minutes - минута часа, в который должен быть выполнен скрипт
        "daily": {
            "on": [
                1
            ],
            "hours": 1,
            "minutes": 0
        },

        // Параметры запуска для ежемесячного периода выполнения. Где:
        // on - массив месяцев от 1 до 12, в которые должен выполняться скрипт
        // days - массив дней от 1 до 31, в которые должен выполняться скрипт
        // hours - час, в который должен быть выполнен скрипт
        // minutes - минута часа, в который должен быть выполнен скрипт
        // lastDate - признак запуска в последний день месяца
        "monthly": {
            "on": [],
            "days": [],
            "lastDate": false,
            "hours": 0,
            "minutes": 0
        }
    }
}
```

#### Создание нового скрипта

Создает новый скрипт в директории проекта и на https://scorocode.ru

```bash
scorocode-cli script -cmd create \
                     -path <путь к файлу с расширением '.js' с/без упоминания каталога '/scripts'> \
                     [-dir <путь к каталогу, в котором находится файл scorocode.json. По умолчанию - это текущий каталог>]

# Example:
# 1.
scorocode-cli script -cmd create -path my_script.js
# или (идентично предыдущему)
scorocode-cli script -cmd create -path /scripts/my_script.js

# 2.
scorocode-cli script -cmd create -path /scripts/my_dir/my_script.js
# или (идентично предыдущему)
scorocode-cli script -cmd create -path /my_dir/my_script.js

```

#### Получить скрипт

Загружает скрипт с https://scorocode.ru в каталог проекта

```bash
scorocode-cli script -cmd get \
                     -path <путь к файлу с расширением '.js' с/без упоминания каталога '/scripts'> \
                     [-dir <путь к каталогу, в котором находится файл scorocode.json. По умолчанию - это текущий каталог>]
```

#### Обновить скрипт

Сохраняет новую версию скрипта на https://scorocode.ru из локальных данных

```bash
scorocode-cli script -cmd update \
                     -path <путь к файлу с расширением '.js' с/без упоминания каталога '/scripts'> \
                     [-dir <путь к каталогу, в котором находится файл scorocode.json. По умолчанию - это текущий каталог>]
```

#### Удалить скрипт

Удалить скрипт в директории проекта и на https://scorocode.ru

```bash
scorocode-cli script -cmd delete \
                     -path <путь к файлу с расширением '.js' с/без упоминания каталога '/scripts'> \
                     [-dir <путь к каталогу, в котором находится файл scorocode.json. По умолчанию - это текущий каталог>]
```

#### Запустить скрипт

Сохраняет новую версию скрипта на https://scorocode.ru из локальных данных и запускает на исполнение
в https://scorocode.ru

```bash
scorocode-cli script -cmd run \
                     -path <путь к файлу с расширением '.js' с/без упоминания каталога '/scripts'> \
                     [-pool <дополнительные параметры скрипта. Путь к файлу '.json' или строка в формате json>] \
                     [-dir <путь к каталогу, в котором находится файл scorocode.json. По умолчанию - это текущий каталог>]
```
